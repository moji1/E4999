<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Lab1</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/labssrc/lab1/lab1.html">
  <link rel="alternate" type="application/rss+xml" title="EEE499- Real-Time Embedded System Design Course Page (Winter 2018)" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">EEE499- Real-Time Embedded System Design Course Page (Winter 2018)</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/404.html"></a>
            
          
            
            
            <a class="page-link" href="/"></a>
            
          
            
            
            <a class="page-link" href="/info/">Course Information</a>
            
          
            
            
          
            
            
          
            
            
            <a class="page-link" href="/Labs/">Labs</a>
            
          
            
            
            <a class="page-link" href="/assets/main.css"></a>
            
          
            
            
            <a class="page-link" href="/Schedule/">Schedule</a>
            
          
            
            
            <a class="page-link" href="/feed.xml"></a>
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Lab1</h1>
  </header>

  <div class="post-content">
    <h3 id="objectives">Objectives</h3>

<p>This lab is an introduction to programming with Arduino. Since the system on which you are going to be working is specific to the test circuit board, you will therefore develop an embedded system.</p>

<p>In the first part of the lab, you will learn how to:</p>

<ul>
  <li>Use the Arduino integrated environment or IED;</li>
  <li>Communicate between the computer and the Arduino board;</li>
  <li>Read sensors on digital ports</li>
  <li>Send control signals on digital ports; et</li>
  <li>Write to the LCD Screen.</li>
</ul>

<p>In the second part of the lab, you must design and implement a  state machine using the state machine pattern that you have learned in EEE320.</p>

<p>You have three weeks to complete this laboratory. Tasks 1 to 5 are relatively easy, do not spend too much time on them. Task 6 is difficult and should take the majority of your time for this lab.</p>

<h3 id="introduction">Introduction</h3>

<p>The microcontroller on the circuit board is programmable uising the Arduino language, which is based on the Wiring language which itself is a subset of C/C++. Programming will therefore be extremely similar to what you have done in EEE243 and EEE435. One of the major difference with the C/C++ programs that you have seen thus far is that you only need two functions in order to have an executable program:</p>

<ul>
  <li><code class="highlighter-rouge">setup()</code>: a function that only executes at the beginning and that can be used to perform the initial configuration.</li>
  <li><code class="highlighter-rouge">loop()</code> – a function that executes in a loop as long as the board is powered.</li>
</ul>

<p>For more details on Arduino, take a look at the Arduino <a href="https://www.arduino.cc/en/Guide/Introduction">introduction</a>.</p>

<p>The laboratory is not a detailed tutorial. We give you references to read so that you can get the implementation details by yourselves.</p>

<h3 id="task-1-transmission-on-the-serial-port">Task 1: Transmission on the serial port</h3>

<p>The first task that is in any early stage of programming is the famous “Hello World!”. We will not stray from this tradition in this lab.</p>

<p>As we have mentioned earlier, there are only two functions required for an Arduino program (<code class="highlighter-rouge">setup()</code> et <code class="highlighter-rouge">loop()</code>). These are created automatically by the Arduino IDE as you create a new project (called sketch in the IDE).</p>

<p>Now launch the IDE (type “Arduino” in the start menu), there will already be an empty <em>sketch</em> that was created. All you have to do is to add your code and load it on the board. Make sure that the board is connected and that the correct port is selected. To do this, go to (<em>Tools &gt; Board &gt; Arduino Mega or Mega 2560</em>). Once this configuration is performed, you can launch the console (<em>Tools &gt; Serial Monitor</em>). There should be no errors.</p>

<p>Although we have installed an LCD screen on the board, we will not use it to display a message initially. We will use serial port communication instead to send a message to the computer and display it to the console of the IDE.</p>

<p>Arduino provides a library to communicate with the serial port. This library is included by default. All you need to do is to initialize the <code class="highlighter-rouge">Serial</code> class with the <code class="highlighter-rouge">begin()</code> method and to display something with the <code class="highlighter-rouge">print()</code> function. After you have read the pages applicable to the <code class="highlighter-rouge">Serial</code> class and its methods <a href="https://www.arduino.cc/en/Reference/Serial">here</a>), display only once the “Hello World!” message on the serial port.</p>

<p>Insure that you save your project with a name like task1_Lapointe_Beaulieu.ino. To complie, you must click on <img src="verify.png" alt="verify" /> or type in combination Ctrl+R (⌘R on Mac). To send your program on the board, click on <img src="upload.png" alt="upload" /> or Ctrl+U (⌘U on Mac).</p>

<p>You should see something like this on your serial monitor. Note that in the lab, there seems to be some garbage characters that sometimes get printed ahead of your message. Just ignore them.</p>

<p><img src="hello.png" alt="hello world!" /></p>

<p>The Arduino library also provides time management functions. The <code class="highlighter-rouge">delay()</code> method allows you to pause the execution. You can find more details on the function <a href="https://www.arduino.cc/en/Reference/Delay">here</a>. There also exists some functions returning the elapsed time since the start of execution (you will need to do some research <a href="https://www.arduino.cc/en/Reference/HomePage">here</a>).</p>

<p>You must now display display the time since the start of execution in 1s intervals. Note that the <code class="highlighter-rouge">print()</code> method does not function like the <code class="highlighter-rouge">printf()</code> in C. You cannot therefore write <code class="highlighter-rouge">printf("time: %d\n", time);</code>.</p>

<p>Save, compile and load your program. You should see something like this in your serial monitor:</p>

<p><img src="time.png" alt="time" /></p>

<p>Perform a demonstration of your program for the instructor before proceeding to the next task.</p>

<h3 id="task-2-receiving-on-the-serial-port">Task 2: Receiving on the serial port</h3>

<p>In the previous task, we transmitted information on the serial port, but we have not accepted any information from the host computer. This is what we are going to do now.</p>

<p>Create a new project and name it something like <em>task2_Lapointe_Beaulieu.ino</em>.</p>

<p>We will again be using the methods of the <code class="highlighter-rouge">Serial</code> class ( <a href="https://www.arduino.cc/en/Reference/Serial">Reference</a>). You must verify if something is present in the buffer of the serial port (<code class="highlighter-rouge">available()</code> method) and read the content interpreting it like a string of character. Note that in C++ there is a class of type <code class="highlighter-rouge">String</code>.</p>

<p>You must write a program that asks the user to enter his\her name and then displays the name followed by a greeting, and then asks for another name. You do not want to display anything as long as the user has not pressed the “Enter” key and you do not want to display a supplementary line.</p>

<p>Save, compile and load your program. You should see something like this on the serial monitor:</p>

<p><img src="input.png" alt="input" /></p>

<p>Demonstrate your program to the instructor before you carry-on with the next task.</p>

<h3 id="task-3-writing-on-a-digital-port">Task 3: Writing on a digital port</h3>

<p>We will now start to use the board to deal with the real world. In order to do so, we will use the digital ports to turn on light emitting diodes that are located on the test board available from the instructors.</p>

<p><img src="test-board.png" alt="planchette de test" /></p>

<p>To start, plug in the ground and the power on the <em>GND</em> and <em>VCC</em> ports respectively. Then plug the diodes on the digital ports 22, 24, 26, 28 using wires and connectors available in the lab. Before going any further, show your setup to the instructor.</p>

<p>When your setup is ready, you can create a new project within the IDE (Give it a name similar to the preceeding ones).</p>

<p>In order to use the digital ports, you must first indicate to the microcontroller if it is an input or output port. You can do this with the <code class="highlighter-rouge">pinMode()</code> method. You can then write on the port indicating the voltage (<code class="highlighter-rouge">LOW</code> or <code class="highlighter-rouge">HIGH</code>). The test board uses the inverse logic, which means that a low voltage turns the LED on and high turns it off.</p>

<p>For this task, you must write code that turns on LEDs one after the other, with an interval of 0.5 seconds.</p>

<p>Save, compile and load your program. Give a demonstration to the instructor before going to the next task.</p>

<h3 id="task-4-reading-of-a-digital-port">Task 4: Reading of a digital port</h3>

<p>Now that you can write on a digital port, you will perform reading an input from a port.</p>

<p>Connect the push buttons on the test board on the digital ports 32, 34, 36, 38.</p>

<p>The final setup should look something like this:</p>

<p><img src="full-setup.png" alt="montage final" /></p>

<p>Instead of starting a new project, save the project of task 3 under another name (Ctrl+Shift+S on Windows and Cmd+Shift+S on Mac).</p>

<p>You must now turn the LEDs when the corresponding button is pressed and turn the LED off when the button is released.</p>

<p>Save, compile and load your program. Demonstrate your program to the instructor before moving on to the next task.</p>

<h3 id="task-5-display-on-the-lcd-screen">Task 5: Display on the LCD screen</h3>

<p>The last task before you have to resolve a real problem is that of displaying something on the LCD screen.</p>

<p>The additions on the basic Arduino board are called <em>shields</em> and they come with different configurations. The one we will use for this lab is a shield with LCD screen from <a href="http://www.dfrobot.com/wiki/index.php/LCD_KeyPad_Shield_For_Arduino_SKU:_DFR0009">DFRobot</a>.</p>

<p>You will have to instal the LiquidCrystal library in order to use the functions that exist for the shield. To install a new library in the Arduino IDE, go into <em>Sketch &gt; Include Library &gt; Manage Libraries</em> and find the LiquidCrystal library. Install the most recent version.</p>

<p><img src="library-search.png" alt="Recherche de bibliothèques" /></p>

<p>When the library is installed, you only need to include (<code class="highlighter-rouge">#include &lt;Library_name.h&gt;</code>). The documentation on how to use the shield can be found <a href="https://www.arduino.cc/en/Reference/LiquidCrystal">here</a>.</p>

<p>All you need to do for this exercise is to ask the user to enter his\her name in the serial monitor (on the LCD screen) and to display “Hello” and the name of the user on the LCD for 6 seconds, then ask for another name.</p>

<p>Save, compile and load your program. Give a demonstration to the instructor before moving to the last part of the lab.</p>

<h3 id="task-6-a-light-dimmer">Task 6: A light dimmer</h3>

<p>For this final task in the lab, you must develop a light dimmer that behaves as follows: Each light has the same behaviour and uses the button that corresponds to it in order.</p>

<ol>
  <li>The light is off initially</li>
  <li>The light turns on in full intensity when the push button is pressed</li>
  <li>The light stays on until the corresponding button is pressed again</li>
  <li>If the button remains pressed for more than a second, the intensity of the light reduces to 0 and then rises again to full intensity.
    <ul>
      <li>The button must remained pressed for 3 seconds for the intensity to go all the way to 0</li>
      <li>The reduction in intensity must be continuous (you cannot define a set of discrete levels of intensity)</li>
      <li>When the minimal intensity is reached, there is a 0.5 second delay before the intensity starts to increase again</li>
    </ul>
  </li>
  <li>If the button is released when the intensity is 0, the next time a button is pressed, the light turns on to full intensity</li>
  <li>If the button is pressed twice in less than 0.5 second, the light starts to flash at max intensity and frequency of 2 Hz
The LCD screen must indicate the state in which the system is.</li>
</ol>

<p>Before you start coding, you must create one or more state machine diagram(s). Use an iterative approach to your design.</p>

<p>In order to simplify the design, we require you to use the state pattern. Here is a partial UML diagram for the design using the state pattern.</p>

<p><img src="state-pattern.png" alt="pattern d'état" /></p>

<p>You must include a class diagram and one or more state diagrams. You can use the software you want to create the diagrams, but we suggest <a href="https://www.lucidchart.com">LucidChart</a>. Insert your diagrams in your report. Make sure that they are legible.</p>

<p>As you will have noticed, you must do object oriented programming and therefore program in C++.</p>

<p>Download the following <a href="oo_example.zip">file</a>, unzip it and open it in the Arduino IDE. It is an example that uses objects to make a LED flash with the <a href="https://en.wikipedia.org/wiki/Morse_code">Morse code</a> pour SOS.</p>

<p>In order to implement the state pattern, you must use inheritance and method overloading.</p>

<p>You can create a sub-class by giving your sub-class the following header:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Sub</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Super</span> <span class="p">{</span>

<span class="p">};</span>
</code></pre></div></div>

<p>To declare abstract methods in the super-class, you must use the key word <code class="highlighter-rouge">virtual</code> in the declaration of the method:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">State</span> <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">pushed</span><span class="p">(</span><span class="kt">int</span> <span class="n">pin</span><span class="p">,</span> <span class="n">StateController</span> <span class="o">*</span><span class="n">m</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>If you want to create a reference to a class from another one, use the following syntax:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StateController</span>
    <span class="p">{</span>
        <span class="k">class</span> <span class="nc">State</span> <span class="o">*</span><span class="n">current</span><span class="p">;</span>

      <span class="k">public</span><span class="o">:</span>
        <span class="n">StateController</span><span class="p">(</span><span class="kt">int</span> <span class="n">pin</span><span class="p">);</span>
        <span class="kt">void</span> <span class="n">btn_pushed</span><span class="p">();</span>
      <span class="k">private</span><span class="o">:</span>
        <span class="kt">int</span> <span class="n">_pin</span><span class="p">;</span>
    <span class="p">};</span>
</code></pre></div></div>

<p>It is possible to initialize objects like this <code class="highlighter-rouge">current = new OFF(pin);</code></p>

<p>Finally, once you want to apply a method on the object, you must proceed as follows <code class="highlighter-rouge">current-&gt;pushed(_pin, this);</code></p>

<p>We recommend that you start with the Morse code example and that you add classes and sub-classes as you progress, compiling often. The first modification that you can do is to activate one of the functions of the <code class="highlighter-rouge">Morse</code> class with a button.</p>

<p>You can read more on C++ <a href="https://en.wikibooks.org/wiki/C%2B%2B_Programming">here</a>.</p>

<p>Provide a demonstration to the instructor.</p>

<h3 id="lab-report">Lab report</h3>

<p>Your lab report should include a cover page, a brief introduction, discussion and conclusion.</p>

<p>Your discussion should explain the design using the UML diagrams and text when necessary. You have to briefly explain what you have learned, findings that you have made, what was challenging in the lab. The discussion must not be a list of steps followed or empty sentences on the usefulness of the lab. Do not regurgitate the lab instructions back. Be concise! One paragraph of good discussion is worth a lot more than 10 pages of fill.</p>

<p>Use the following format for your <a href="http://localhost:4000/assets/docs/lab-report.docx">report</a>.</p>

<h3 id="submission">Submission</h3>

<p>You must submit your lab report in <em>PDF</em> format and your code by e-mail in a <em>.zip</em> file.</p>

  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">
    <!--
    <h2 class="footer-heading">EEE499- Real-Time Embedded System Design Course Page (Winter 2018)</h2>
    -->
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              Copyright © 2017 Mojtaba Bagherzadeh. All Rights Reserved.
            
            </li>
            
            <li><a href="mailto:mojtaba@cs.queensu.ca">mojtaba@cs.queensu.ca</a></li>
            
        </ul>
      </div>
      <!--
      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>
      -->
      <!--
      <div class="footer-col footer-col-3">
        <p></p>
      </div>
     -->
    </div>
    
  </div>

</footer>


  </body>

</html>
